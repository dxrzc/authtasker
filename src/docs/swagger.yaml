openapi: 3.0.0
info:
  title: Authtasker API
  version: 1.0.0
  contact:
    name: Diego Rodriguez    
    email: diegorodriguezc.dev@gmail.com

servers:
  - url: https://api.myapp.com
    description: Production
  - url: http://localhost:3000
    description: Local development

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    CreateUserRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          minLength: 5
          maxLength: 15
          description: The user's full name
          example: John Doe
        email:
          type: string
          format: email
          description: The user's email address
          example: john@example.com
        password:
          type: string
          minLength: 8
          maxLength: 120
          description: The user's password (supports passphrases up to 120 characters)
          example: password123
    LoginUserRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: The user's email address
          example: john@example.com
        password:
          type: string
          description: The user's password
          example: password123
    LogoutRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: The refresh token to invalidate
          example: 9b1deb4d-3b7d-4bad-9bdd-2b0d7b3dcb6d
    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: The refresh token to use for obtaining new tokens
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 5
          maxLength: 15
          description: The user's full name. Will be converted to lowercase and trimmed.
          example: John Doe
        email:
          type: string
          format: email
          description: The user's email address. Updating this will trigger security actions.
          example: john@example.com
        password:
          type: string
          minLength: 8
          maxLength: 120
          description: The user's password. Updating this will trigger security actions.
          example: newpassword123
    User:
      type: object
      required:
        - id
        - name
        - email
        - role
        - emailValidated
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          description: Unique identifier for the user
          example: 60d0fe4f5311236168a109ca
        name:
          type: string
          description: The user's full name
          example: john doe
        email:
          type: string
          description: The user's email address
          example: john@example.com
        role:
          type: string
          description: The user's role in the system
          enum: [admin, editor, readonly]
          example: readonly
        emailValidated:
          type: boolean
          description: Whether the user's email has been validated
          example: false
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the user was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the user was last updated
    AuthResponse:
      type: object
      required:
        - user
        - sessionToken
        - refreshToken
      properties:
        user:
          $ref: '#/components/schemas/User'
        sessionToken:
          type: string
          description: JWT token for session authentication
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          description: Token used to refresh the session token
          example: 9b1deb4d-3b7d-4bad-9bdd-2b0d7b3dcb6d
    RefreshTokenResponse:
      type: object
      required:
        - sessionToken
        - refreshToken
      properties:
        sessionToken:
          type: string
          description: New JWT token for session authentication
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          description: New token used to refresh the session token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: Error description
    UsersPaginationResponse:
      type: object
      required:
        - totalDocuments
        - totalPages
        - currentPage
        - data
      properties:
        totalDocuments:
          type: integer
          description: Total number of users in the database
          example: 42
        totalPages:
          type: integer
          description: Total number of pages based on the limit
          example: 9
        currentPage:
          type: integer
          description: The current page number being returned
          example: 1
        data:
          type: array
          description: Array of user objects for the current page
          items:
            $ref: '#/components/schemas/User'
    PasswordRecoveryRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          description: The user's email address to send password recovery link
          example: john@example.com
    ResetPasswordRequest:
      type: object
      required:
        - token
        - newPassword
      properties:
        token:
          type: string
          description: The password recovery token received via email
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        newPassword:
          type: string
          minLength: 8
          maxLength: 120
          description: The new password for the user account (supports passphrases up to 120 characters)
          example: newpassword123
    SuccessMessage:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Success message
          example: Operation completed successfully
    CreateTaskRequest:
      type: object
      required:
        - name
        - description
        - status
        - priority
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 40
          description: The task name. Will be converted to lowercase and trimmed.
          example: complete project documentation
        description:
          type: string
          minLength: 10
          maxLength: 120
          description: The task description
          example: Write comprehensive API documentation for all endpoints
        status:
          type: string
          enum: [pending, in-progress, completed, archived]
          description: The task status
          example: pending
        priority:
          type: string
          enum: [low, medium, high]
          description: The task priority
          example: high
    UpdateTaskRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 40
          description: The task name. Will be converted to lowercase and trimmed.
          example: complete project documentation
        description:
          type: string
          minLength: 10
          maxLength: 120
          description: The task description
          example: Write comprehensive API documentation for all endpoints
        status:
          type: string
          enum: [pending, in-progress, completed, archived]
          description: The task status
          example: in-progress
        priority:
          type: string
          enum: [low, medium, high]
          description: The task priority
          example: high
    Task:
      type: object
      required:
        - id
        - name
        - description
        - status
        - priority
        - user
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          description: Unique identifier for the task
          example: 60d0fe4f5311236168a109ca
        name:
          type: string
          description: The task name
          example: complete project documentation
        description:
          type: string
          description: The task description
          example: Write comprehensive API documentation for all endpoints
        status:
          type: string
          enum: [pending, in-progress, completed, archived]
          description: The task status
          example: pending
        priority:
          type: string
          enum: [low, medium, high]
          description: The task priority
          example: high
        user:
          type: string
          description: User ID who created the task
          example: 60d0fe4f5311236168a109ca
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the task was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the task was last updated
    TasksPaginationResponse:
      type: object
      required:
        - totalDocuments
        - totalPages
        - currentPage
        - data
      properties:
        totalDocuments:
          type: integer
          description: Total number of tasks in the database (or matching the filter)
          example: 42
        totalPages:
          type: integer
          description: Total number of pages based on the limit
          example: 9
        currentPage:
          type: integer
          description: The current page number being returned
          example: 1
        data:
          type: array
          description: Array of task objects for the current page
          items:
            $ref: '#/components/schemas/Task'

paths:
  /api/users/register:
    post:
      operationId: registerUser
      summary: Register a new user
      description: |
        Creates a new user **readonly** account.
        - **Returns**: The created user along with a session token (expires in 10 minutes) and a refresh token (expires in 30 days) for maintaining the session.        
        - **Constraints:**
          - Email must be unique and valid email format.
          - Name must be a unique username between 5-15 characters.
          - Password must be between 8-120 characters.
        - **Side Effects:**
          - Username is converted to lowercase and leading/trailing spaces are trimmed.
          - Password is pre-hashed using SHA-256 HMAC with a pepper, then hashed using bcrypt.   
          - A refresh token is generated and stored in Redis with a 30-day expiration.
          - `emailValidated` is set to `false` by default.
          - `credentialsChangedAt` is set to the current timestamp.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.        
        - **Additional Notes:**
          - To upgrade the role from **readonly** to **editor**, you need to request and complete email validation.
          - The password field is never returned in responses.        
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: |
           **User created successfully**             
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: |
            **Invalid input**

            Possible causes:
              - Name not provided.
              - Name length is not between 5-15 characters.
              - Email not provided.
              - Invalid email format.
              - Password not provided.
              - Password length is not between 8-120 characters.
              - Unexpected property in request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid input
        '409':
          description: |
            **Conflict**             
            
            Possible causes:
              - The email is already registered.
              - The username is already taken.            
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: User already exists
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/login:
    post:
      operationId: loginUser
      summary: Login a user
      description: |        
        Authenticates a user using their email and password.
        - **Returns**: The user data, a session token (expires in 10 minutes), and a refresh token (expires in 30 days) for maintaining the session.        
        - **Constraints:**
          - Maximum active sessions (refresh tokens) are limited to 3 per user.
        - **Side Effects:**
          - A new session is created by generating a session token and refresh token.
          - Refresh token is stored in Redis with user association.
          - If session limit is reached, the oldest refresh token is automatically evicted.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - Invalid credentials error is intentionally vague to prevent user enumeration attacks.                        
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginUserRequest'
      responses:
        '200':
          description: |
           **User logged in successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: |
            **Invalid credentials**

            Possible causes:
              - Email not registered.
              - Incorrect password.
              - Invalid email format.
              - Password not provided.
              - Email not provided.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid credentials
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/logout:
    post:
      operationId: logoutUser
      summary: Logout a user
      description: |
        Logs out the user from the current session.
        - **Side Effects:**       
          - The provided refresh token is revoked and removed from Redis.
          - The current session token is blacklisted in Redis until its natural expiration.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - Other session tokens obtained previously are not blacklisted; they will expire naturally.
          - Requires a valid session token in the Authorization header.
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '204':
          description: |
            **Logout successful**
        '400':
          description: | 
            **Refresh token not provided**

            Possible causes:
              - Refresh token missing in request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Refresh token expected in body
        '401':
          description: | 
            **Unauthorized**

            Possible causes (session token):
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.

            Possible causes (refresh token):
              - Refresh token is expired or not signed by this server.
              - User ID is missing in the refresh token payload.
              - Refresh token has been revoked (not found in Redis).
              - User associated with the refresh token no longer exists.
              - Refresh token was issued before user's last credentials change.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: | 
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/logout-all:
    post:
      operationId: logoutFromAll
      summary: Logout from all sessions
      description: |
        Logs out the user from all active sessions. Password is required for reauthentication.
        - **Constraints:**
          - Requires valid password for reauthentication.
        - **Side Effects:**
          - All user's refresh tokens are revoked and removed from Redis.
          - The current session token is blacklisted in Redis until its natural expiration.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - Other session tokens obtained previously are not blacklisted; they will expire naturally.
          - This is useful when a user suspects their account has been compromised.
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  description: The user's password for reauthentication
                  example: password123
      responses:
        '204':
          description: |
            **All sessions successfully invalidated**
        '401':
          description: |
            **Unauthorized** 
            
            Possible causes (session token):
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.

            Possible causes (password):
              - Incorrect password provided.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid credentials
        '429':
          description: | 
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/refresh-token:
    post:
      operationId: refreshToken
      summary: Refresh session token
      description: |
        Generates a new session token (expires in 10 minutes) and refresh token using a valid refresh token.
        This endpoint implements token rotation: the old refresh token is invalidated and a new one is issued.
        - **Returns**: A new session token and a new refresh token.       
        - **Side Effects:**
          - The old refresh token is invalidated and removed from Redis.
          - A new refresh token is stored in Redis with the same expiration time as the original.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - The new refresh token maintains the same expiration time as the original token (does not extend the 30-day window).
          - Does not require a session token in the Authorization header.        
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: |
            **Tokens refreshed successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '400':
          description: |
            **Bad Request**

            Possible causes:
              - Refresh token not provided in request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Refresh token expected in body
        '401':
          description: |
            **Unauthorized** 
            
            Possible causes:
              - Refresh token is expired or not signed by this server.
              - User ID is missing in the refresh token payload.
              - Refresh token has been revoked (not found in Redis).
              - User associated with the refresh token no longer exists.
              - Refresh token was issued before user's last credentials change.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/forgot-password:
    post:
      operationId: requestPasswordRecovery
      summary: Request password recovery
      description: |
        Initiates the password recovery process by sending a password reset link to the user's email address.
        - **Returns**: A success message regardless of whether the email exists (prevents user enumeration).
        - **Side Effects:**
          - If the email exists, a password recovery token (JWT) is generated with a 10-minute expiration.
          - An email with the reset link is sent to the provided email address.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - The password reset link contains a token query parameter.
          - The token is single-use and blacklisted after successful password reset.
          - Always returns success to prevent email enumeration attacks.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordRecoveryRequest'
      responses:
        '200':
          description: |
            **Password recovery email sent successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
              example:
                message: If that account exists, you will receive an email.
        '400':
          description: |
            **Bad request**

            Possible causes:
              - Email not provided in the request body.
              - Invalid email format.
              - Unexpected property in request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                emailNotProvided:
                  value:
                    error: Email not provided
                invalidEmail:
                  value:
                    error: Invalid email
        '429':
          description: | 
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/reset-password:
    get:
      operationId: resetPasswordForm
      summary: Display password reset form
      description: |
        Displays an HTML form for resetting the user's password.
        This endpoint is accessed via the password reset link sent to the user's email.
        - **Returns**: An HTML page with a password reset form.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - The token is passed through as a hidden field in the form.
          - Token value is escaped to prevent XSS attacks.        
      tags:
        - Users
      parameters:
        - in: query
          name: token
          schema:
            type: string
          required: true
          description: The password recovery token received via email
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: |
            **HTML form for password reset**
          content:
            text/html:
              schema:
                type: string
                description: HTML page with a form to reset password
        '400':
          description: |
            **Bad request**

            Possible causes:
              - Token not provided in query parameters.
              - Token format is invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '429':
          description: | 
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

    post:
      operationId: resetPassword
      summary: Reset user password
      description: |
        Resets the user's password using a valid password recovery token.
        - **Returns:** A success message confirming password reset.
        - **Constraints:**
          - Password must be between 8-120 characters.
          - Token must be valid and not expired.
        - **Side Effects:**
          - The password recovery token is blacklisted after use (single-use).
          - All refresh tokens associated with the user are revoked.
          - Password is pre-hashed using SHA-256 HMAC with a pepper, then hashed using bcrypt.
          - User's `credentialsChangedAt` is updated to current timestamp.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - User will need to log in again after password reset.
          - All existing sessions become invalid due to refresh token revocation.        
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: |
            **Password reset successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
              example:
                message: Password has been successfully reset
        '400':
          description: |
            **Bad request** 
            
            Possible causes:
              - Token not provided in the request body.
              - Invalid token format.
              - New password not provided in the request body.
              - New password length is not between 8-120 characters.
              - Unexpected property in request body.              
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidToken:
                  value:
                    error: Invalid token
                invalidPasswordLength:
                  value:
                    error: Invalid password length
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Password recovery token is expired or not signed by this server.
              - Email is missing in the password recovery token payload.
              - Token purpose is not PASSWORD_RECOVERY.
              - Token has already been used (blacklisted).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '429':
          description: | 
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error                

  /api/users/me:
    get:
      operationId: getMyProfile
      summary: Get authenticated user's profile
      description: |
        Retrieves the profile information of the currently authenticated user.
        - **Returns**: The authenticated user's profile data.
        - **Caching:** User data is cached for 10 seconds. After TTL expiration, data is revalidated against the database `updatedAt` field before serving stale content or fetching fresh data.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: READONLY).
          - User ID is extracted from the session token payload.
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: |
            **User profile retrieved successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/request-email-validation:
    post:
      operationId: requestEmailValidation
      summary: Request email validation
      description: |
        Sends an email validation link to the authenticated user's email address.
        - **Constraints:**
          - Only available for users with the READONLY role (unvalidated email).
        - **Side Effects:**
          - Generates an email validation token (JWT) with a 10-minute expiration.
          - Sends an email with the validation link to the user's registered email address.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - Once the user validates their email via the link, their role will be upgraded from READONLY to EDITOR.
          - Users with EDITOR or ADMIN roles cannot request email validation (returns 409 Conflict).
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '204':
          description: |
            **Email validation link sent successfully**
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '409':
          description: |
            **Conflict**

            Possible causes:
              - User's email is already verified (role is EDITOR or ADMIN).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Email is already verified
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/confirm-email-validation:
    get:
      operationId: confirmEmailValidation
      summary: Confirm email validation
      description: |
        Confirms the user's email address using a validation token.
        This endpoint is accessed via the email validation link sent to the user's email.
        - **Returns**: A success message confirming email validation.
        - **Constraints:**
          - Token must be valid and not expired.
          - Token must not have been previously used (blacklisted).
          - Token purpose must be EMAIL_VALIDATION.
        - **Side Effects:**
          - User's `emailValidated` field is set to `true`.
          - User's role is upgraded from READONLY to EDITOR.
          - The token is blacklisted to prevent reuse (one-time use only).
          - User is removed from cache to ensure fresh data on next request.
        - **Rate Limiting:** Limited to 3 requests per minute per IP.
        - **Additional Notes:**
          - Does not require authentication (token-based approach).
          - The token has a 10-minute lifetime.
      tags:
        - Users
      parameters:
        - in: query
          name: token
          schema:
            type: string
          required: true
          description: The email validation token received via email
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: |
            **Email validated successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
              example:
                message: Email successfully validated
        '400':
          description: |
            **Bad request**

            Possible causes:
              - Token not provided in query parameters.
              - Token format is invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Email validation token is expired or not signed by this server.
              - Email is missing in the email validation token payload.
              - Token purpose is not EMAIL_VALIDATION.
              - Token has already been used (blacklisted).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '409':
          description: |
            **Conflict**

            Possible causes:
              - User's email is already verified.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Email is already verified
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users/{id}:
    get:
      operationId: getUserById
      summary: Get user by ID
      description: |
        Retrieves detailed information about a specific user by their unique ID.
        - **Returns**: The user's profile data.
        - **Caching:** User data is cached for 10 seconds. After TTL expiration, data is revalidated against the database `updatedAt` field before serving stale content or fetching fresh data.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: READONLY).
          - Any authenticated user can view any other user's profile.
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: The unique identifier of the user
      responses:
        '200':
          description: |
            **User details**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '404':
          description: |
            **Not Found**

            Possible causes:
              - The provided ID is not a valid MongoDB ObjectId.
              - No user exists with the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: User not found
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

    delete:
      operationId: deleteUserById
      summary: Delete user by ID
      description: |
        Deletes a specific user by their unique ID.
        - **Constraints:**
          - Users can only delete their own account (self-deletion).
          - Admin users can delete users with READONLY or EDITOR roles.
          - Admin users cannot delete other admin users.
          - Non-admin users cannot delete other users.
        - **Side Effects:**
          - The user record is removed from the database.
          - All refresh tokens associated with the user are revoked from Redis.
          - All tasks associated with the user are permanently deleted (uses MongoDB transaction).
          - User is removed from cache if present.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: READONLY).
          - User deletion and task deletion are performed atomically within a transaction.
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: The unique identifier of the user to delete
      responses:
        '204':
          description: |
            **User deleted successfully**
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '403':
          description: |
            **Forbidden**

            Possible causes:
              - A non-admin user attempts to delete another user.
              - An admin user attempts to delete another admin user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: You do not have permission to perform this action
        '404':
          description: |
            **Not Found**

            Possible causes:
              - The provided ID is not a valid MongoDB ObjectId.
              - No user exists with the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: User not found
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error
    patch:
      operationId: updateUserById
      summary: Update user by ID
      description: |
        Updates a specific user by their unique ID.
        - **Constraints:**
          - Users can only update their own account (self-update).
          - Admin users can update users with READONLY or EDITOR roles.
          - Admin users cannot update other admin users.
          - Non-admin users cannot update other users.
          - At least one field must be provided for update.
        - **Side Effects:**
          - If `name` is updated: Name is converted to lowercase and trimmed.
          - If `email` is updated (non-admin): Role is downgraded to READONLY, `emailValidated` is set to false.
          - If `email` is updated (admin): Role and `emailValidated` remain unchanged.
          - If `email` or `password` is updated: All refresh tokens are revoked, session token is blacklisted, user is removed from cache, `credentialsChangedAt` is updated.
          - If `password` is updated: Password is pre-hashed using SHA-256 HMAC with a pepper, then hashed using bcrypt.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: READONLY).
          - If email or password is updated, user will need to log in again with new credentials.
          - Updatable fields: `name`, `email`, `password` (all optional).
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: The unique identifier of the user to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: |
            **User updated successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: |
            **Bad request**

            Possible causes:
              - No properties to update provided in the request body.
              - Name length is not between 5-15 characters.
              - Invalid email format.
              - Password length is not between 8-120 characters.
              - Unexpected property in request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                noProperties:
                  value:
                    error: No properties to update
                invalidInput:
                  value:
                    error: Invalid input
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '403':
          description: |
            **Forbidden**

            Possible causes:
              - A non-admin user attempts to update another user.
              - An admin user attempts to update another admin user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: You do not have permission to perform this action
        '404':
          description: |
            **Not Found**

            Possible causes:
              - The provided ID is not a valid MongoDB ObjectId.
              - No user exists with the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: User not found
        '409':
          description: |
            **Conflict**

            Possible causes:
              - The new email is already registered by another user.
              - The new name is already taken by another user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                emailExists:
                  value:
                    error: Email already exists
                nameExists:
                  value:
                    error: User already exists
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/users:
    get:
      operationId: findAllUsers
      summary: Get all users with pagination
      description: |
        Retrieves a paginated list of all users in the system.
        - **Returns**: A paginated response containing user data, total documents, total pages, and current page.
        - **Constraints:**
          - Page must be a positive integer (minimum: 1).
          - Limit must be a positive integer (minimum: 1, maximum: 100).
        - **Caching:** Individual user records are cached for 10 seconds. After TTL expiration, data is revalidated against the database `updatedAt` field.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: READONLY).
          - Default pagination: page=1, limit=5.
          - Results are sorted by creation date (oldest first), then by ID.
          - If requested page exceeds total pages, an empty data array is returned.
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          required: false
          description: Page number to retrieve (starts at 1)
          example: 1
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 5
          required: false
          description: Number of users per page (max 100)
          example: 10
      responses:
        '200':
          description: |
            **Paginated list of users retrieved successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersPaginationResponse'
              example:
                totalDocuments: 42
                totalPages: 5
                currentPage: 1
                data:
                  - id: 60d0fe4f5311236168a109ca
                    name: john doe
                    email: john@example.com
                    role: editor
                    emailValidated: true
                    createdAt: '2021-06-21T12:00:00.000Z'
                    updatedAt: '2021-06-21T12:00:00.000Z'
                  - id: 60d0fe4f5311236168a109cb
                    name: jane smith
                    email: jane@example.com
                    role: readonly
                    emailValidated: false
                    createdAt: '2021-06-21T13:00:00.000Z'
                    updatedAt: '2021-06-21T13:00:00.000Z'
        '400':
          description: |
            **Bad request**

            Possible causes:
              - The `page` parameter is not a valid positive integer.
              - The `limit` parameter is not a valid positive integer.
              - The `limit` parameter exceeds 100.
              - The `page` or `limit` parameter is less than or equal to 0.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidPage:
                  value:
                    error: Invalid page
                invalidLimit:
                  value:
                    error: Invalid limit
                limitTooLarge:
                  value:
                    error: Limit is too large
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/tasks/create:
    post:
      operationId: createTask
      summary: Create a new task
      description: |
        Creates a new task for the authenticated user.
        - **Returns**: The created task object.
        - **Constraints:**
          - Task name must be unique across all tasks.
          - Name must be between 3-40 characters.
          - Description must be between 10-120 characters.
          - Status must be one of: pending, in-progress, completed, archived.
          - Priority must be one of: low, medium, high.
          - Only users with EDITOR or ADMIN role can create tasks.
        - **Side Effects:**
          - Task name is converted to lowercase and trimmed before saving.
          - Task is automatically associated with the authenticated user.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: EDITOR).
          - READONLY users cannot create tasks.
      tags:
        - Tasks
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '201':
          description: |
            **Task created successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          description: |
            **Bad request**

            Possible causes:
              - Name not provided.
              - Name length is not between 3-40 characters.
              - Description not provided.
              - Description length is not between 10-120 characters.
              - Status not provided.
              - Invalid status value.
              - Priority not provided.
              - Invalid priority value.
              - Unexpected property in request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidInput:
                  value:
                    error: Invalid input
                invalidStatus:
                  value:
                    error: Invalid task status
                invalidPriority:
                  value:
                    error: Invalid task priority
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '403':
          description: |
            **Forbidden**

            Possible causes:
              - User has READONLY role (cannot create tasks).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Verify your email to perform this action
        '409':
          description: |
            **Conflict**

            Possible causes:
              - Task with the same name already exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Task already exists
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/tasks/{id}:
    get:
      operationId: getTaskById
      summary: Get task by ID
      description: |
        Retrieves detailed information about a specific task by its unique ID.
        - **Returns**: The task object.
        - **Caching:** Task data is cached for 10 seconds. After TTL expiration, data is revalidated against the database `updatedAt` field before serving stale content or fetching fresh data.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: READONLY).
          - Any authenticated user can view any task (no ownership restrictions).
      tags:
        - Tasks
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: The task ID (MongoDB ObjectId)
          example: 60d0fe4f5311236168a109ca
      responses:
        '200':
          description: |
            **Task details retrieved successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '404':
          description: |
            **Not Found**

            Possible causes:
              - The provided ID is not a valid MongoDB ObjectId.
              - No task exists with the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Task not found
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

    delete:
      operationId: deleteTaskById
      summary: Delete task by ID
      description: |
        Deletes a specific task by its unique ID.
        - **Constraints:**
          - Users can only delete their own tasks.
          - Admin users can delete tasks owned by users with READONLY or EDITOR roles.
          - Admin users cannot delete tasks owned by other admin users.
          - Non-owner users cannot delete other users' tasks.
          - Only users with EDITOR or ADMIN role can delete tasks.
        - **Side Effects:**
          - The task record is permanently removed from the database.
          - Task is removed from cache if present.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: EDITOR).
          - READONLY users cannot delete any tasks.
      tags:
        - Tasks
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: The task ID to delete (MongoDB ObjectId)
          example: 60d0fe4f5311236168a109ca
      responses:
        '204':
          description: |
            **Task deleted successfully**
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '403':
          description: |
            **Forbidden**

            Possible causes:
              - User has READONLY role (cannot delete any tasks).
              - A non-owner attempts to delete another user's task.
              - An admin user attempts to delete a task owned by another admin user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: You do not have permission to perform this action
        '404':
          description: |
            **Not Found**

            Possible causes:
              - The provided ID is not a valid MongoDB ObjectId.
              - No task exists with the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Task not found
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

    patch:
      operationId: updateTaskById
      summary: Update task by ID
      description: |
        Updates a specific task by its unique ID.
        - **Returns**: The updated task object.
        - **Constraints:**
          - Users can only update their own tasks.
          - Admin users can update tasks owned by users with READONLY or EDITOR roles.
          - Admin users cannot update tasks owned by other admin users.
          - Non-owner users cannot update other users' tasks.
          - At least one field must be provided for update.
          - If name is updated, it must be unique across all tasks (3-40 characters).
          - If description is updated, it must be between 10-120 characters.
          - If status is updated, it must be one of: pending, in-progress, completed, archived.
          - If priority is updated, it must be one of: low, medium, high.
          - Only users with EDITOR or ADMIN role can update tasks.
        - **Side Effects:**
          - If name is updated, it is converted to lowercase and trimmed before saving.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: EDITOR).
          - Updatable fields: `name`, `description`, `status`, `priority` (all optional).
          - READONLY users cannot update any tasks.
      tags:
        - Tasks
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: The task ID to update (MongoDB ObjectId)
          example: 60d0fe4f5311236168a109ca
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTaskRequest'
      responses:
        '200':
          description: |
            **Task updated successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          description: |
            **Bad request**

            Possible causes:
              - No properties to update provided in the request body.
              - Name length is not between 3-40 characters.
              - Description length is not between 10-120 characters.
              - Invalid status value.
              - Invalid priority value.
              - Unexpected property in request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                noProperties:
                  value:
                    error: No properties to update
                invalidInput:
                  value:
                    error: Invalid input
                invalidStatus:
                  value:
                    error: Invalid task status
                invalidPriority:
                  value:
                    error: Invalid task priority
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '403':
          description: |
            **Forbidden**

            Possible causes:
              - User has READONLY role (cannot update any tasks).
              - A non-owner attempts to update another user's task.
              - An admin user attempts to update a task owned by another admin user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: You do not have permission to perform this action
        '404':
          description: |
            **Not Found**

            Possible causes:
              - The provided ID is not a valid MongoDB ObjectId.
              - No task exists with the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Task not found
        '409':
          description: |
            **Conflict**

            Possible causes:
              - Task with the new name already exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Task already exists
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error

  /api/tasks:
    get:
      operationId: findAllTasks
      summary: Get all tasks with pagination and optional filters
      description: |
        Retrieves a paginated list of tasks with optional filtering capabilities.
        Filters can be combined in any way: use all filters together, any subset of them, or none at all.

        - **Returns**: A paginated response containing task data, total documents, total pages, and current page.
        - **Constraints:**
          - Page must be a positive integer (minimum: 1).
          - Limit must be a positive integer (minimum: 1, maximum: 100).
          - If `status` filter is provided, it must be one of: pending, in-progress, completed, archived.
          - If `priority` filter is provided, it must be one of: low, medium, high.
          - If `user` filter is provided, it must be a valid MongoDB ObjectId of an existing user.
        - **Caching:** Individual task records are cached for 10 seconds. After TTL expiration, data is revalidated against the database `updatedAt` field.
        - **Rate Limiting:** Limited to 100 requests per 5 minutes per IP.
        - **Additional Notes:**
          - Requires authentication via Bearer token (minimum role: READONLY).
          - Default pagination: page=1, limit=5.
          - Results are sorted by creation date (oldest first), then by ID.
          - All authenticated users can view all tasks (no filtering by ownership).
          - If requested page exceeds total pages, an empty data array is returned.
          - Filters are applied with AND logic when multiple are provided.
          - Without any filters, returns all tasks in the system.
      tags:
        - Tasks
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          required: false
          description: Page number to retrieve (starts at 1)
          example: 1
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 5
          required: false
          description: Number of tasks per page (max 100)
          example: 10
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, in-progress, completed, archived]
          required: false
          description: Filter tasks by status
          example: pending
        - in: query
          name: priority
          schema:
            type: string
            enum: [low, medium, high]
          required: false
          description: Filter tasks by priority level
          example: high
        - in: query
          name: user
          schema:
            type: string
          required: false
          description: Filter tasks by owner user ID (MongoDB ObjectId)
          example: 60d0fe4f5311236168a109ca
      responses:
        '200':
          description: |
            **Paginated list of tasks retrieved successfully**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TasksPaginationResponse'
              examples:
                noFilters:
                  summary: All tasks (no filters)
                  value:
                    totalDocuments: 42
                    totalPages: 5
                    currentPage: 1
                    data:
                      - id: 60d0fe4f5311236168a109ca
                        name: complete project documentation
                        description: Write comprehensive API documentation for all endpoints
                        status: pending
                        priority: high
                        user: 60d0fe4f5311236168a109ca
                        createdAt: '2021-06-21T12:00:00.000Z'
                        updatedAt: '2021-06-21T12:00:00.000Z'
                      - id: 60d0fe4f5311236168a109cb
                        name: fix authentication bug
                        description: Resolve issue with JWT token validation in middleware
                        status: in-progress
                        priority: medium
                        user: 60d0fe4f5311236168a109cb
                        createdAt: '2021-06-21T13:00:00.000Z'
                        updatedAt: '2021-06-21T13:00:00.000Z'
                withStatusFilter:
                  summary: Tasks filtered by status
                  value:
                    totalDocuments: 15
                    totalPages: 2
                    currentPage: 1
                    data:
                      - id: 60d0fe4f5311236168a109ca
                        name: complete project documentation
                        description: Write comprehensive API documentation for all endpoints
                        status: pending
                        priority: high
                        user: 60d0fe4f5311236168a109ca
                        createdAt: '2021-06-21T12:00:00.000Z'
                        updatedAt: '2021-06-21T12:00:00.000Z'
                withMultipleFilters:
                  summary: Tasks filtered by status and priority
                  value:
                    totalDocuments: 5
                    totalPages: 1
                    currentPage: 1
                    data:
                      - id: 60d0fe4f5311236168a109ca
                        name: complete project documentation
                        description: Write comprehensive API documentation for all endpoints
                        status: pending
                        priority: high
                        user: 60d0fe4f5311236168a109ca
                        createdAt: '2021-06-21T12:00:00.000Z'
                        updatedAt: '2021-06-21T12:00:00.000Z'
        '400':
          description: |
            **Bad request**

            Possible causes:
              - The `page` parameter is not a valid positive integer.
              - The `limit` parameter is not a valid positive integer.
              - The `limit` parameter exceeds 100.
              - The `page` or `limit` parameter is less than or equal to 0.
              - The `status` filter is not one of: pending, in-progress, completed, archived.
              - The `priority` filter is not one of: low, medium, high.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidPage:
                  value:
                    error: Invalid page
                invalidLimit:
                  value:
                    error: Invalid limit
                limitTooLarge:
                  value:
                    error: Limit is too large
                invalidStatus:
                  value:
                    error: Invalid task status
                invalidPriority:
                  value:
                    error: Invalid task priority
        '401':
          description: |
            **Unauthorized**

            Possible causes:
              - Session token is expired or not signed by this server.
              - Session token purpose is not SESSION.
              - Session token is blacklisted.
              - User ID is missing in the session token payload.
              - User associated with the session token no longer exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid token
        '404':
          description: |
            **Not Found**

            Possible causes:
              - The `user` filter contains an invalid MongoDB ObjectId.
              - No user exists with the ID provided in the `user` filter.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: User not found
        '429':
          description: |
            **Too many requests**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Too many requests
        '500':
          description: |
            **Internal server error**
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Internal server error
